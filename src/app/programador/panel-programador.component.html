<div class="programmer-container">
    <header class="programmer-header">
        <h1>Panel de Programador</h1>
        <div class="user-info" *ngIf="usuario">
            <span>Hola, {{ usuario.nombre }}</span>
            <button (click)="cerrarSesion()" class="logout-btn">Cerrar Sesión</button>
        </div>
    </header>

    <nav class="programmer-nav">
        <button [class.active]="seccionActiva === 'proyectos'" (click)="seccionActiva = 'proyectos'">Mis
            Proyectos</button>
        <button [class.active]="seccionActiva === 'perfil'" (click)="seccionActiva = 'perfil'">Mi Perfil</button>
        <button [class.active]="seccionActiva === 'asesorias'" (click)="seccionActiva = 'asesorias'">Asesorías</button>
    </nav>

    <main class="programmer-content">

        <!-- SECCIÓN: MIS PROYECTOS -->
        <section *ngIf="seccionActiva === 'proyectos'" class="projects-section">
            <div class="section-header">
                <h2>Mis Proyectos</h2>
                <button (click)="abrirModalProyecto()" class="add-btn">+ Nuevo Proyecto</button>
            </div>

            <!-- Indicador de carga -->
            <div *ngIf="cargandoProyectos" class="empty-state">
                <div class="spinner"></div>
                <p>Cargando proyectos...</p>
            </div>

            <!-- Grid de proyectos -->
            <div class="projects-grid" *ngIf="!cargandoProyectos">
                <div *ngFor="let proyecto of proyectos" class="project-card">
                    <h3>{{ proyecto.nombre }}</h3>
                    <p class="desc">{{ proyecto.descripcion }}</p>
                    <div class="tags">
                        <span class="tag type">{{ proyecto.tipo }}</span>
                        <span class="tag role">{{ proyecto.participacion }}</span>
                    </div>
                    <div class="techs">
                        <span *ngFor="let tech of proyecto.tecnologias" class="tech-badge">{{ tech }}</span>
                    </div>
                    <div class="actions">
                        <button (click)="editarProyecto(proyecto)" class="edit-btn">Editar</button>
                        <button (click)="eliminarProyecto(proyecto.id!)" class="delete-btn">Eliminar</button>
                    </div>
                </div>
            </div>

            <!-- Estado vacío -->
            <div *ngIf="!cargandoProyectos && proyectos.length === 0" class="empty-state">
                <p>No tienes proyectos registrados aún.</p>
            </div>
        </section>

        <!-- SECCIÓN: MI PERFIL -->
        <section *ngIf="seccionActiva === 'perfil'" class="profile-section">
            <h2>Editar Perfil</h2>
            <div class="profile-card" *ngIf="perfilForm">
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input [(ngModel)]="perfilForm.nombre" placeholder="Tu nombre">
                </div>

                <div class="form-group">
                    <label>Especialidad</label>
                    <input [(ngModel)]="perfilForm.especialidad" placeholder="Ej: Desarrollador Frontend">
                </div>

                <div class="form-group">
                    <label>Descripción Profesional</label>
                    <textarea [(ngModel)]="perfilForm.descripcion" rows="4"
                        placeholder="Cuéntanos sobre ti..."></textarea>
                </div>

                <div class="form-group">
                    <label>URL Foto de Perfil</label>
                    <input [(ngModel)]="perfilForm.fotoPerfil" placeholder="https://...">
                    <img *ngIf="perfilForm.fotoPerfil" [src]="perfilForm.fotoPerfil" class="preview-img"
                        alt="Vista previa">
                </div>

                <h3>Redes Sociales</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>LinkedIn</label>
                        <input [(ngModel)]="perfilForm.redesSociales!.linkedin" placeholder="URL LinkedIn">
                    </div>
                    <div class="form-group">
                        <label>GitHub</label>
                        <input [(ngModel)]="perfilForm.redesSociales!.github" placeholder="URL GitHub">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Twitter / X</label>
                        <input [(ngModel)]="perfilForm.redesSociales!.twitter" placeholder="URL Twitter">
                    </div>
                    <div class="form-group">
                        <label>Sitio Web Personal</label>
                        <input [(ngModel)]="perfilForm.redesSociales!.sitioWeb" placeholder="URL Sitio Web">
                    </div>
                </div>

                <div class="profile-actions">
                    <button 
                        (click)="guardarPerfil()" 
                        class="save-btn"
                        [disabled]="guardandoPerfil"
                        [class.disabled]="guardandoPerfil">
                        {{ guardandoPerfil ? 'Guardando...' : 'Guardar Cambios' }}
                    </button>
                </div>
            </div>
        </section>

        <!-- SECCIÓN: ASESORÍAS -->
        <section *ngIf="seccionActiva === 'asesorias'" class="advisories-section">
            <h2>Solicitudes de Asesoría</h2>

            <!-- Indicador de carga -->
            <div *ngIf="cargandoAsesorias" class="empty-state">
                <div class="spinner"></div>
                <p>Cargando asesorías...</p>
            </div>

            <!-- Lista de asesorías -->
            <div class="advisories-list" *ngIf="!cargandoAsesorias">
                <div *ngFor="let asesoria of asesorias" class="advisory-card"
                    [class.pending]="asesoria.estado === 'pendiente'">
                    <div class="advisory-header">
                        <span class="status-badge" [ngClass]="asesoria.estado">{{ obtenerEstadoFormateado(asesoria.estado) }}</span>
                        <span class="date">{{ obtenerFechaFormateada(asesoria.fechaSolicitud) }}</span>
                    </div>

                    <div class="advisory-body">
                        <h4>Solicitado por: {{ asesoria.nombreUsuario }}</h4>
                        <p><strong>Fecha propuesta:</strong> {{ asesoria.fechaAsesoria }} a las {{ asesoria.horaAsesoria
                            }}</p>
                        <p><strong>Motivo:</strong> {{ asesoria.motivo }}</p>
                        <p><strong>Contacto:</strong> {{ asesoria.emailUsuario }}</p>
                    </div>

                    <div class="advisory-actions" *ngIf="asesoria.estado === 'pendiente'">
                        <button 
                            (click)="responderAsesoria(asesoria, 'aprobada')" 
                            class="accept-btn"
                            [disabled]="respondiendoAsesoria"
                            [class.disabled]="respondiendoAsesoria">
                            {{ respondiendoAsesoria ? 'Procesando...' : 'Aceptar' }}
                        </button>
                        <button 
                            (click)="responderAsesoria(asesoria, 'rechazada')" 
                            class="reject-btn"
                            [disabled]="respondiendoAsesoria"
                            [class.disabled]="respondiendoAsesoria">
                            {{ respondiendoAsesoria ? 'Procesando...' : 'Rechazar' }}
                        </button>
                    </div>

                    <div class="advisory-response" *ngIf="asesoria.estado !== 'pendiente'">
                        <p><strong>Respuesta:</strong> {{ asesoria.mensajeRespuesta || 'Sin mensaje adicional' }}</p>
                    </div>

                    <div class="advisory-cancellation" *ngIf="asesoria.estado === 'cancelada' && asesoria.motivoCancelacion">
                        <p><strong>Motivo de Cancelación:</strong> {{ asesoria.motivoCancelacion }}</p>
                    </div>
                </div>
            </div>

            <!-- Estado vacío -->
            <div *ngIf="!cargandoAsesorias && asesorias.length === 0" class="empty-state">
                <p>No tienes solicitudes de asesoría pendientes.</p>
            </div>
        </section>

    </main>

    <!-- MODAL PROYECTO -->
    <div *ngIf="mostrarModalProyecto" class="modal-overlay">
        <div class="modal-content">
            <h3>{{ proyectoEditando?.id ? 'Editar' : 'Nuevo' }} Proyecto</h3>

            <div class="form-group">
                <label>Nombre del Proyecto</label>
                <input [(ngModel)]="proyectoForm.nombre" placeholder="Ej: E-commerce Angular">
            </div>

            <div class="form-group">
                <label>Descripción</label>
                <textarea [(ngModel)]="proyectoForm.descripcion" rows="3"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Tipo</label>
                    <select [(ngModel)]="proyectoForm.tipo">
                        <option value="academico">Académico</option>
                        <option value="laboral">Laboral</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Participación</label>
                    <select [(ngModel)]="proyectoForm.participacion">
                        <option value="Frontend">Frontend</option>
                        <option value="Backend">Backend</option>
                        <option value="Base de Datos">Base de Datos</option>
                        <option value="Fullstack">Fullstack</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Tecnologías (separadas por coma)</label>
                <input [ngModel]="tecnologiasInput" (ngModelChange)="actualizarTecnologias($event)"
                    placeholder="Ej: Angular, Firebase, Node.js">
            </div>

            <div class="form-group">
                <label>URL Repositorio (GitHub)</label>
                <input [(ngModel)]="proyectoForm.repoUrl">
            </div>

            <div class="form-group">
                <label>URL Demo (Despliegue)</label>
                <input [(ngModel)]="proyectoForm.demoUrl">
            </div>

            <div class="modal-actions">
                <button 
                    (click)="guardarProyecto()" 
                    class="save-btn"
                    [disabled]="guardandoProyecto"
                    [class.disabled]="guardandoProyecto">
                    {{ guardandoProyecto ? 'Guardando...' : 'Guardar' }}
                </button>
                <button (click)="cerrarModalProyecto()" class="cancel-btn" [disabled]="guardandoProyecto">Cancelar</button>
            </div>
        </div>
    </div>

</div>
<div class="admin-container">
  <header class="admin-header">
    <div class="header-content">
      <div class="brand">
        <div class="brand-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
        </div>
        <div>
          <h1>Panel de Administrador</h1>
          <p class="subtitle">Gestión de usuarios y permisos</p>
        </div>
      </div>
      <button (click)="cerrarSesion()" class="logout-btn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
        </svg>
        Cerrar Sesión
      </button>
    </div>
  </header>

  <main class="admin-content">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon admin">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">Administradores</p>
          <p class="stat-value">{{ (usuarios | filter:'administrador').length }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon programmer">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">Programadores</p>
          <p class="stat-value">{{ (usuarios | filter:'programador').length }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon user">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">Usuarios</p>
          <p class="stat-value">{{ (usuarios | filter:'usuario').length }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon total">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 13c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h13zm-1-2H4V4h11v7zM20 17c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h2zm-1-2h-1v-2h1v2zM9 22h6c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1H9c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1zm1-4h4v3h-4v-3z"/>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">Total Usuarios</p>
          <p class="stat-value">{{ usuarios.length }}</p>
        </div>
      </div>
    </div>

    <section class="users-section">
      <div class="section-header">
        <h2>Gestión de Usuarios</h2>
        <div class="search-box">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
          <input type="text" placeholder="Buscar usuarios..." [(ngModel)]="filtro" (input)="filtrarUsuarios()">
        </div>
      </div>

      <div class="table-container">
        <table class="users-table">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let usuario of usuariosFiltrados" [class.highlight]="usuario.uid === usuarioSeleccionado?.uid">
              <td>
                <div class="user-cell">
                  <img [src]="usuario.fotoPerfil || 'https://ui-avatars.com/api/?name=' + usuario.nombre" 
                       [alt]="usuario.nombre" 
                       class="user-avatar">
                  <span class="user-name">{{ usuario.nombre }}</span>
                </div>
              </td>
              <td>{{ usuario.email }}</td>
              <td>
                <span class="badge" [ngClass]="usuario.rol">{{ usuario.rol }}</span>
              </td>
              <td>
                <span class="status-badge active">Activo</span>
              </td>
              <td>
                <button (click)="editarUsuario(usuario)" class="edit-btn" title="Editar usuario">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                  </svg>
                  Editar
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <div *ngIf="usuariosFiltrados.length === 0" class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
          <p>No se encontraron usuarios</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal de Edición -->
  <div *ngIf="usuarioSeleccionado" class="modal-overlay" (click)="cancelarEdicion()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Editar Usuario</h3>
        <button class="close-btn" (click)="cancelarEdicion()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="user-preview">
          <img [src]="usuarioSeleccionado.fotoPerfil || 'https://ui-avatars.com/api/?name=' + usuarioSeleccionado.nombre" 
               [alt]="usuarioSeleccionado.nombre">
          <div>
            <h4>{{ usuarioSeleccionado.nombre }}</h4>
            <p>{{ usuarioSeleccionado.email }}</p>
          </div>
        </div>

        <div class="form-group">
          <label>Rol de Usuario</label>
          <select [(ngModel)]="usuarioSeleccionado.rol" class="form-control">
            <option value="usuario">Usuario</option>
            <option value="programador">Programador</option>
            <option value="administrador">Administrador</option>
          </select>
          <p class="help-text">Selecciona el rol apropiado para este usuario</p>
        </div>

        <div *ngIf="usuarioSeleccionado.rol === 'programador'" class="programmer-fields">
          <div class="form-group">
            <label>Especialidad</label>
            <input [(ngModel)]="usuarioSeleccionado.especialidad" 
                   placeholder="Ej: Fullstack Developer, Frontend Expert..."
                   class="form-control">
          </div>
          
          <div class="form-group">
            <label>Descripción Profesional</label>
            <textarea [(ngModel)]="usuarioSeleccionado.descripcion" 
                      placeholder="Breve descripción profesional del programador..."
                      rows="4"
                      class="form-control"></textarea>
          </div>

          <div class="form-group">
            <label>Tecnologías (separadas por coma)</label>
            <input [ngModel]="usuarioSeleccionado.tecnologias?.join(', ')"
                   (ngModelChange)="actualizarTecnologias($event)"
                   placeholder="Angular, React, Node.js, Python..."
                   class="form-control">
          </div>

          <div class="form-group" *ngIf="usuarioSeleccionado.disponibilidad">
            <label>Disponibilidad Semanal</label>
            <div class="days-selector">
              <button *ngFor="let dia of ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo']"
                      class="day-chip"
                      [class.selected]="esDiaSeleccionado(dia)"
                      (click)="toggleDia(dia)">
                {{ dia }}
              </button>
            </div>
          </div>

          <div class="form-group" *ngIf="usuarioSeleccionado.disponibilidad">
            <label>Horario de Atención</label>
            <div class="time-range">
              <input type="time" [(ngModel)]="usuarioSeleccionado.disponibilidad.horaInicio" class="form-control">
              <span>a</span>
              <input type="time" [(ngModel)]="usuarioSeleccionado.disponibilidad.horaFin" class="form-control">
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button (click)="cancelarEdicion()" class="btn btn-cancel">Cancelar</button>
        <button (click)="guardarCambios()" class="btn btn-save" [disabled]="guardando">
          <span *ngIf="!guardando">Guardar Cambios</span>
          <span *ngIf="guardando">Guardando...</span>
        </button>
      </div>
    </div>
  </div>
</div>

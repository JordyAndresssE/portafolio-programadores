<div class="admin-container">

  <!-- HEADER -->
  <header class="admin-header">
    <div class="header-content">

      <div class="brand">
        <div class="brand-icon">
          ‚úî
        </div>
        <div>
          <h1>Panel de Administrador</h1>
          <p class="subtitle">Gesti√≥n de usuarios y permisos</p>
        </div>
      </div>

      <button (click)="cerrarSesion()" class="logout-btn">
        ‚¨Ö Cerrar Sesi√≥n
      </button>

    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="admin-content">

    <!-- TARJETAS DE ESTAD√çSTICAS -->
    <div class="stats-grid">

      <div class="stat-card">
        <div class="stat-icon admin">üë§</div>
        <div class="stat-info">
          <p class="stat-label">Administradores</p>
          <p class="stat-value">{{ (usuarios | filter:'administrador').length }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon programmer">üíª</div>
        <div class="stat-info">
          <p class="stat-label">Programadores</p>
          <p class="stat-value">{{ (usuarios | filter:'programador').length }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon user">üôÇ</div>
        <div class="stat-info">
          <p class="stat-label">Usuarios</p>
          <p class="stat-value">{{ (usuarios | filter:'usuario').length }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon total">üìä</div>
        <div class="stat-info">
          <p class="stat-label">Total Usuarios</p>
          <p class="stat-value">{{ usuarios.length }}</p>
        </div>
      </div>

    </div>

    <!-- SECCI√ìN DE REPORTES -->
    <section class="reports-section" style="margin-bottom: 2rem;">
      <div class="section-header">
        <h2>üìä Reportes Administrativos</h2>
      </div>
      
      <div class="reports-actions" style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <button 
          class="btn btn-report" 
          (click)="descargarReporteAsesoriasPDF()"
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
          üìÑ Descargar Reporte Asesor√≠as (PDF)
        </button>
        
        <button 
          class="btn btn-report" 
          (click)="descargarReporteProyectosExcel()"
          style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
          üìä Descargar Reporte Proyectos (Excel)
        </button>
      </div>
    </section>

    <!-- TABLA DE USUARIOS -->
    <section class="users-section">

      <div class="section-header">
        <h2>Gesti√≥n de Usuarios</h2>

        <div class="search-box">
          <input type="text" placeholder="Buscar usuarios..." [(ngModel)]="filtro" (input)="filtrarUsuarios()">
        </div>
      </div>

      <div class="table-container">

        <table class="users-table">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let usuario of usuariosFiltrados" [class.highlight]="usuario.uid === usuarioSeleccionado?.uid">

              <td>
                <div class="user-cell">
                  <img [src]="usuario.fotoPerfil || 'https://ui-avatars.com/api/?name=' + usuario.nombre"
                    [alt]="usuario.nombre" class="user-avatar">
                  <span>{{ usuario.nombre }}</span>
                </div>
              </td>

              <td>{{ usuario.email }}</td>

              <td>
                <span class="badge" [ngClass]="usuario.rol">{{ usuario.rol }}</span>
              </td>

              <td>
                <span class="status-badge active">Activo</span>
              </td>

              <td>
                <button class="edit-btn" (click)="editarUsuario(usuario)">‚úè Editar</button>
              </td>

            </tr>
          </tbody>
        </table>

        <div *ngIf="usuariosFiltrados.length === 0" class="empty-state">
          ‚ö† No se encontraron usuarios
        </div>

      </div>
    </section>

  </main>

  <!-- MODAL EDITAR -->
  <div *ngIf="usuarioSeleccionado" class="modal-overlay" (click)="cancelarEdicion()">
    <div class="modal-content" (click)="$event.stopPropagation()">

      <div class="modal-header">
        <h3>Editar Usuario</h3>
        <button class="close-btn" (click)="cancelarEdicion()">‚úñ</button>
      </div>

      <div class="modal-body">

        <!-- Vista previa -->
        <div class="user-preview">
          <img
            [src]="usuarioSeleccionado.fotoPerfil || 'https://ui-avatars.com/api/?name=' + usuarioSeleccionado.nombre">
          <div>
            <h4>{{ usuarioSeleccionado.nombre }}</h4>
            <p>{{ usuarioSeleccionado.email }}</p>
          </div>
        </div>

        <!-- Select rol -->
        <div class="form-group">
          <label>Rol de Usuario</label>
          <select [(ngModel)]="usuarioSeleccionado.rol" class="form-control">
            <option value="usuario">Usuario</option>
            <option value="programador">Programador</option>
            <option value="administrador">Administrador</option>
          </select>
        </div>

        <!-- Campos de programador -->
        <div *ngIf="usuarioSeleccionado.rol === 'programador'">

          <div class="form-group">
            <label>Especialidad</label>
            <input [(ngModel)]="usuarioSeleccionado.especialidad" placeholder="Ej: Fullstack Developer"
              class="form-control">
          </div>

          <div class="form-group">
            <label>Descripci√≥n</label>
            <textarea [(ngModel)]="usuarioSeleccionado.descripcion" rows="3" class="form-control"></textarea>
          </div>

          <div class="form-group">
            <label>Tecnolog√≠as</label>
            <input [ngModel]="usuarioSeleccionado.tecnologias?.join(', ')"
              (ngModelChange)="actualizarTecnologias($event)" placeholder="Angular, React, Node.js..."
              class="form-control">
          </div>

          <div class="form-group" *ngIf="usuarioSeleccionado.disponibilidad">
            <label>Disponibilidad Personalizada por D√≠a</label>
            <p class="help-text">Configura horarios espec√≠ficos para cada d√≠a de la semana</p>

            <div class="disponibilidad-personalizada">
              <div *ngFor="let dia of diasSemana" class="dia-config">
                <div class="dia-header">
                  <label class="checkbox-container">
                    <input type="checkbox" [checked]="esDiaActivo(dia)" (change)="toggleDiaPersonalizado(dia)">
                    <span class="dia-nombre">{{ dia }}</span>
                  </label>
                </div>

                <div class="dia-horarios" *ngIf="esDiaActivo(dia)">
                  <div class="horario-inputs">
                    <div class="input-group">
                      <label>Desde</label>
                      <input type="time" [value]="getHoraInicio(dia)" (change)="setHoraInicio(dia, $event)"
                        class="time-input">
                    </div>
                    <span class="separator">‚Üí</span>
                    <div class="input-group">
                      <label>Hasta</label>
                      <input type="time" [value]="getHoraFin(dia)" (change)="setHoraFin(dia, $event)"
                        class="time-input">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

      <div class="modal-footer">
        <button class="btn btn-cancel" (click)="cancelarEdicion()">Cancelar</button>
        <button class="btn btn-save" (click)="guardarCambios()" [disabled]="guardando">
          {{ guardando ? 'Guardando...' : 'Guardar' }}
        </button>
      </div>

    </div>
  </div>

</div>